<div class="columns" [style]="{backgroundImage: getBg()}">
  <div class="container columns__container">
    <div class="loader" *ngIf="loaderService.isLoading | async">
      <mat-spinner color="warn" mode="indeterminate"></mat-spinner>
    </div>
    <div class="columns__head">
      <button class="back" (click)="goBack()">
        <svg fill="white" xmlns="http://www.w3.org/2000/svg" height="24" width="24">
          <path d="m14 18-6-6 6-6 1.4 1.4-4.6 4.6 4.6 4.6Z" />
        </svg>
      </button>
      <div class="columns__title">
        {{'columns.title' | translate}}: <span class="columns__id">{{ boardName }}</span>
      </div>
    </div>
    <div cdkDropListGroup cdkDropList [cdkDropListData]="boardsService.columns" cdkDropListOrientation="horizontal"
      (cdkDropListDropped)="drop($event)" class="columns__content">
      <div cdkDrag [cdkDragDisabled]="(changeId === column.id) || isTaskChange" class="columns__item" [attr.data-id]="column.id"
        *ngFor="let column of boardsService.columns">
        <div class="columns__name" (click)="changeOn(column.title, column.id)">
          {{ column.title }}
        </div>
        <ng-container *ngIf="(changeId === column.id)">
          <ng-container *ngTemplateOutlet="changeForm; context: column"></ng-container>
        </ng-container>
        <div class="tasks" cdkDropList [cdkDropListData]="getTasks(column.id)" (cdkDropListDropped)="dropTask($event)">
          <app-task *ngFor="let task of getTasks(column.id)" (isChangeTask)="changeTask($event)" [task]="task" [tasks]="tasks"></app-task>
        </div>
        <div class="columns__setting">
          <button class="add-item" (click)="addTask(column.id)">{{ 'columns.add-task' | translate }}</button>
          <button class="button delete-item" (click)="removeColumn(column.id)">
            <svg class="delete-item" xmlns="http://www.w3.org/2000/svg" height="24" width="24">
              <path
                d="M7 21q-.825 0-1.412-.587Q5 19.825 5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413Q17.825 21 17 21ZM17 6H7v13h10ZM9 17h2V8H9Zm4 0h2V8h-2ZM7 6v13Z" />
            </svg>
          </button>
        </div>
      </div>
      <button class="columns__item empty" [disabled]="changeId" (click)="addColumn()">
        <h6 class="empty__title">{{ 'columns.add-btn' | translate }}</h6>
      </button>
      <app-modal-add *ngIf="modalAddService.isVisible" [tasks]="tasks">
      </app-modal-add>
      <app-modal-warn *ngIf="modalWarnService.isOpen" [tasks]="tasks"></app-modal-warn>
    </div>
  </div>
</div>

<ng-template #changeForm let-title="title" let-columnId="id">
  <div class="overview"></div>
  <div class="change-form" [formGroup]="form" (ngSubmit)="submitForm(columnId)">
    <form class="change__form">
      <div class="error-input">
        <mat-form-field class="change__input" color="accent">
          <mat-label>{{ 'tasks.change-title' | translate }}</mat-label>
          <input matInput formControlName="title" [placeholder]="'boards.change-label' | translate">
        </mat-form-field>
        <ng-container *ngTemplateOutlet="errors; context: form.controls.title"></ng-container>
      </div>
      <div class="change__buttons">
        <button class="change-button" mat-raised-button color="accent" [disabled]="!form.valid">
          {{ 'boards.change-btn' | translate }}
        </button>
        <button type="button" class="change-button" mat-raised-button color="warn" (click)="cancelChange()">
          {{ 'boards.cancel-btn' | translate }}
        </button>
      </div>
    </form>
  </div>
</ng-template>


<ng-template #errors let-errors="errors" let-touched="touched">
  <app-errors [errors]="errors" [touched]="touched" bottom="bottom: -0.1rem;" [isLite]="true"></app-errors>
</ng-template>