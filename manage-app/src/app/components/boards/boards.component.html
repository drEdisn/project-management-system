<div class="contianer boards">
  <div class="boards__container">
    <div class="loader" *ngIf="loaderService.isLoading | async">
      <mat-spinner color="warn" mode="indeterminate"></mat-spinner>
    </div>
    <h2 class="boards__title title">{{ 'boards.title' | translate }}</h2>
    <div class="boards__content">
      <div class="boards__item" [style]="{backgroundImage: getImage(board.id)}" *ngFor="let board of boardsService.boards">
        <div class="link" [routerLink]="['/boards', board.id]"></div>
        <div class="setting">
          <span class="setting__edit" (click)="changeBoard(board.title, board.id)">
            <svg class="setting__svg" xmlns="http://www.w3.org/2000/svg" height="24" width="24">
              <path
                d="M5 19h1.4l8.625-8.625-1.4-1.4L5 17.6ZM19.3 8.925l-4.25-4.2 1.4-1.4q.575-.575 1.413-.575.837 0 1.412.575l1.4 1.4q.575.575.6 1.388.025.812-.55 1.387ZM17.85 10.4 7.25 21H3v-4.25l10.6-10.6Zm-3.525-.725-.7-.7 1.4 1.4Z" />
            </svg>
          </span>
          <span class="setting__change-bg" (click)="changeBg(board.id)">
            <svg class="setting__bg" xmlns="http://www.w3.org/2000/svg" height="24" width="24">
              <path
                d="m9.25 22-.4-3.2q-.325-.125-.612-.3-.288-.175-.563-.375L4.7 19.375l-2.75-4.75 2.575-1.95Q4.5 12.5 4.5 12.337v-.675q0-.162.025-.337L1.95 9.375l2.75-4.75 2.975 1.25q.275-.2.575-.375.3-.175.6-.3l.4-3.2h5.5l.4 3.2q.325.125.613.3.287.175.562.375l2.975-1.25 2.75 4.75-2.575 1.95q.025.175.025.337v.675q0 .163-.05.338l2.575 1.95-2.75 4.75-2.95-1.25q-.275.2-.575.375-.3.175-.6.3l-.4 3.2Zm2.8-6.5q1.45 0 2.475-1.025Q15.55 13.45 15.55 12q0-1.45-1.025-2.475Q13.5 8.5 12.05 8.5q-1.475 0-2.488 1.025Q8.55 10.55 8.55 12q0 1.45 1.012 2.475Q10.575 15.5 12.05 15.5Zm0-2q-.625 0-1.062-.438-.438-.437-.438-1.062t.438-1.062q.437-.438 1.062-.438t1.063.438q.437.437.437 1.062t-.437 1.062q-.438.438-1.063.438ZM12 12Zm-1 8h1.975l.35-2.65q.775-.2 1.438-.588.662-.387 1.212-.937l2.475 1.025.975-1.7-2.15-1.625q.125-.35.175-.738.05-.387.05-.787t-.05-.788q-.05-.387-.175-.737l2.15-1.625-.975-1.7-2.475 1.05q-.55-.575-1.212-.963-.663-.387-1.438-.587L13 4h-1.975l-.35 2.65q-.775.2-1.437.587-.663.388-1.213.938L5.55 7.15l-.975 1.7 2.15 1.6q-.125.375-.175.75-.05.375-.05.8 0 .4.05.775t.175.75l-2.15 1.625.975 1.7 2.475-1.05q.55.575 1.213.962.662.388 1.437.588Z" />
            </svg>
          </span>
        </div>
        <div class="boards__name" *ngIf="!(changeId === board.id)">
          {{ board.title }}
        </div>
        <ng-container *ngIf="(changeBgId === board.id)">
          <ng-container *ngTemplateOutlet="background; context: board"></ng-container>
        </ng-container>
        <ng-container *ngIf="(changeId === board.id)">
          <ng-container *ngTemplateOutlet="changeForm; context: board"></ng-container>
        </ng-container>
        <button class="boards__delete button" (click)="removeBoardWarn(board.id)">
          <svg fill="white" xmlns="http://www.w3.org/2000/svg" height="24" width="24">
            <path
              d="M7 21q-.825 0-1.412-.587Q5 19.825 5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413Q17.825 21 17 21ZM17 6H7v13h10ZM9 17h2V8H9Zm4 0h2V8h-2ZM7 6v13Z" />
          </svg>
        </button>
      </div>
      <button class="boards__empty" [disabled]="changeId !== null" *ngIf="!isCreated; else boardForm"
        (click)="changeCreated()">
        <span class="boards__empty-text">{{ 'boards.add-btn' | translate }}</span>
      </button>
    </div>
  </div>
  <app-modal-warn *ngIf="modalWarnService.isOpen"></app-modal-warn>
</div>

<ng-template #changeForm let-title="title" let-boardId="id">
  <div class="change-form" [formGroup]="form" (ngSubmit)="submitForm('change', boardId)">
    <form class="change__form">
      <div class="error-input">
        <mat-form-field class="change__input" color="accent">
          <mat-label>{{ 'tasks.change-title' | translate }}</mat-label>
          <input matInput formControlName="title" [placeholder]="'boards.change-label' | translate">
        </mat-form-field>
        <ng-container *ngTemplateOutlet="errors; context: form.controls.title"></ng-container>
      </div>
      <div class="change__buttons">
        <button class="change-button" mat-raised-button color="accent" [disabled]="!form.valid">{{ 'boards.change-btn' | translate }}</button>
        <button type="button" class="change-button" mat-raised-button color="warn" (click)="cancelChange()">
          {{ 'boards.cancel-btn' | translate }}
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #boardForm>
  <form class="boards__empty hovered" [formGroup]="form" (ngSubmit)="submitForm()">
    <div class="boards__input">
      <app-input nameTitle="title" pathTitle="tasks.change-title" [value]="form.controls">
        <input class="input" type="text" formControlName="title" [(ngModel)]="title">
      </app-input>
      <ng-container *ngTemplateOutlet="errors; context: form.controls.title"></ng-container>
    </div>
    <div class="buttons">
      <button type="submit" class="boards__empty-btn button" [disabled]="!form.valid">
        {{ 'boards.create-btn' | translate }}
      </button>
      <button type="button" class="boards__empty-btn cansel button" (click)="changeCreated()">
        {{ 'boards.cancel-btn' | translate }}
      </button>
    </div>
  </form>
</ng-template>

<ng-template #errors let-errors="errors" let-touched="touched">
  <app-errors [errors]="errors" [touched]="touched"
    [bottom]="changeId !== null ? 'bottom: -0.2rem;' : 'bottom: -1.6rem;'" [isLite]="changeId !== null"></app-errors>
</ng-template>

<ng-template #background let-boardId="id">
  <div class="bg__content">
    <button class="bg__close" (click)="closeChangeBg()">
      <svg fill="#fff" xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 48 48"><path d="m16.5 33.6 7.5-7.5 7.5 7.5 2.1-2.1-7.5-7.5 7.5-7.5-2.1-2.1-7.5 7.5-7.5-7.5-2.1 2.1 7.5 7.5-7.5 7.5ZM24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Z"/></svg>
    </button>
    <img src="./assets/bg-1.jpg" (click)="setImage(boardId, './assets/bg-1.jpg')" alt="bg" class="background">
    <img src="./assets/bg-2.jpg" (click)="setImage(boardId, './assets/bg-2.jpg')" alt="bg" class="background">
    <img src="./assets/bg-3.jpg" (click)="setImage(boardId, './assets/bg-3.jpg')" alt="bg" class="background">
    <img src="./assets/bg-4.jpg" (click)="setImage(boardId, './assets/bg-4.jpg')" alt="bg" class="background">
    <img src="./assets/bg-5.jpg" (click)="setImage(boardId, './assets/bg-5.jpg')" alt="bg" class="background">
    <img src="./assets/bg-6.jpg" (click)="setImage(boardId, './assets/bg-6.jpg')" alt="bg" class="background">
  </div>
</ng-template>